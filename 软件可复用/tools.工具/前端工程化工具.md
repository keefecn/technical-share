| 序号 | 修改时间   | 修改内容                                   | 修改人 | 审稿人 |
| ---- | ---------- | ------------------------------------------ | ------ | ------ |
| 1    | 2021-11-18 | 创建。从《前端框架分析》相关章节迁移成文。 | Keefe  | Keefe  |
|      |            |                                            |        |        |





---



[TOC]



---

## 1 前端工程化概述

前端开发过程产生的问题

1.　ECMAScript（ES）规范与浏览器兼容性不一致：想使用最新的ECMAScript规范进行开发，但受限于浏览器实现，需要适配旧规范。
2.　CSS的弱编程能力：想使用LESS/SASS等预编译语法或者PostCSS自动处理hack。
3.　资源定位：本地开发静态资源引用的是本地相对路径，上线前需要修改为真实URL。
4.　考虑产品性能：需要压缩静态资源，图片压缩/BASE64内嵌/CSS Sprites。
5.　模块依赖分析和压缩打包：模块化开发，提高维护效率。上线前模块需要进行依赖分析和合并打包。
6.　协作层面：前端依赖后端数据
7.　部署层面：静态文件（JS/CSS/图片）与动态文件(HTML模板)仍然存在于同一项目，前端部分资源仍然需要后端工程师部署。

说明：针对上面七大问题。前面五大是开发问题。



前端工程化流水线要经过大概四个阶段：脚手架 --> 构建 --> 本地开发服务器 --> 部署

| 阶段           | 目的                                                         | 功能                                                         | 工具                        |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------- |
| 脚手架         | 快速搭建前端基本环境，以聚焦业务。                           | 包括自动安装、统一工具栈等。                                 | [Yeoman](http://yeoman.io/) |
| 构建<br>       | 也叫编译。将源代码中转化成宿主浏览器能执行的代码。解决前端七大问题中的开发问题。 | 解决依赖打包、资源嵌入、文件压缩、HASH指纹等。构建还包括构建需要解决3类问题，分别是语言、优化和部署。 | webpack                     |
| 本地开发服务器 | 本地服务器最典型的应用是MOCK服务，通过模拟接口和数据解决前端JS对数据API的依赖问题，从而实现前后端并行开发。 | MOCK服务。<br>支持SSR（服务器端渲染）。<br>动态构建。        |                             |
| 部署           |                                                              |                                                              |                             |



表格 构建步骤的前端资源变化

| 源资源                                               | 构建后产出资源 | 构建动作             |
| ---------------------------------------------------- | -------------- | -------------------- |
| 领先于浏览器实现的ECMAScript规范编写的JS代码 (xx.es) | JS             | ECMAScript规范编转译 |
| LESS/SAAS预编译语法编写的CSS代码 (xx.less)           | CSS            | CSS预编译语法转译    |
| Jade/EJS/Mustache等模板语法编写的HTML代码 (xx.jade)  | html           | HTML模板渲染         |

  

## 2 前端工具

表格  前端常用工具1

| 工具                                     | 简介                                                         | 安装                                                         | 使用                                   |
| ---------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------- |
| node.js                                  | 建立在谷歌Chrome的JavaScript引擎(V8引擎)的Web应用程序框架。  | `nvm install 5.1.0`   或者<br>`apt-get install nodejs`       | node -v                                |
| [npm](https://www.npmjs.com/)/   cnpm    | NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题。用来安装npm包。cnpm为中国区。 | `npm install -g cnpm --registry=https://registry.npm.taobao.org` | npm -v   npm install   [xxx]           |
| nvm                                      | node.js的包管理工具。                                        | curl  -o https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh \| bash | nvm  --version   nvm install [version] |
| yarn                                     | 替代npm。为了弥补 npm 的一些缺陷而出现的。                   | npm install -g yarn                                          |                                        |
| webpack                                  | 模块打包工具。2012.3诞生。                                   | npm install webpack@xx -g                                    |                                        |
| babel                                    | Babel 是一个 JavaScript 编译器，是一个工具链。<br>主要用于将 ECMAScript 2015+ 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。（ES转译） |                                                              |                                        |
| [Gulp](https://www.gulpjs.com.cn/)       | 2012.3诞生。基于 Node.js 的项目、流(stream)的自动化构建工具。<br/>Grunt 采用配置文件的方式执行任务，而 [Gulp](https://www.gulpjs.com.cn/) 一切都通过代码实现。 | npm install gulp -g                                          | gulp [js_pipe]   gulp deploy           |
| [Grunt](http://www.gruntjs.net/)         | 2012.6诞生。Grunt 是基于 Node.js 的项目构建工具。<br>它可以自动运行你所设定的任务。Grunt 拥有数量庞大的插件。 | npm install -g grunt-cli                                     |                                        |
| bower                                    | npm包，前端管理工具，专门用来管理WEB前端依赖包（JS/CSS/IMAGES/fonts） | npm  install bower<br>bower init 初始化生成bower.json        | bower install xx                       |
| n                                        | 用来管理nodejs版本。<br>查看nodejs版本：n lsr                | npm install -g n                                             | 安装指定版本：n xx                     |
| npx                                      | npm5.2+版本新增。npx 想要解决的主要问题，就是调用项目内部安装的模块。<br>运行的时候，会到`node_modules/.bin`路径和环境变量`$PATH`里面，检查命令是否存在。 |                                                              |                                        |
| [lerna](https://github.com/lerna/lerna/) | Lerna 是一种工具，针对 使用 git 和 npm 管理多软件包代码仓库的工作流程进行优化 |                                                              |                                        |

备注：cnpm类似npm，只是源在中国。



表格 前端常用工具2

| 工具名                                                       | 用途                                                         | 备注 |
| :----------------------------------------------------------- | ------------------------------------------------------------ | ---- |
| [PostCSS](https://www.postcss.com.cn/)                       | CSS预编译器。支持未来 CSS 语法、模块化、代码检测等。         |      |
| [LESS](https://www.bootcss.com/p/lesscss/)/[SASS](https://www.sasscss.com/) | CSS预编译语法转换。                                          |      |
| CommonJS                                                     | 面向浏览器以外的JavaScript模块化规范。原名ServeJS，2019年改现名，被Nodejs采纳为默认的模块化规范。 | 弃   |
| AMD/CMD                                                      | CommonJS的变种，主要针对浏览器环境的模板化规范。             | 弃   |
| ES6 Module                                                   | 规范的静态模块体系。                                         | 标准 |
| [ESLint](https://cn.eslint.org/)                             | ESLint 是一个插件化并且可配置的 JavaScript 语法规则和代码风格的检查工具。ESLint 能够帮你轻松写出高质量的 JavaScript 代码。 |      |

备注：模块化规范有三种分别是CommonJS、AMD/CMD和ES6 Module，任选其一即可。在ES6 Module推出后，另外二种退出舞台。



### npm&cnpm

npm是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：

- 允许用户从NPM服务器下载别人编写的第三方包到本地使用。

- 允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。

- 允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。

  ```sh
  # 查看当前版本
  $ npm -v
  
  # install后空是根据当前目录下的package.json安装；否则安装指定包，@版本号
  npm install
  npm install xx
  npm install xx@x.x
  
  # npm升级自身 
  $ npm install npm -g
  ```

**cnpm**:  淘宝镜像的npm, 中国区用户速度更快

```shell
# 安装cnpm
$ npm install -g cnpm --registry=https://registry.npm.taobao.org 
```



**npm命令**

```sh
$ npm --help
Usage: npm <command>

where <command> is one of:
    access, adduser, audit, bin, bugs, c, cache, ci, cit,
    clean-install, clean-install-test, completion, config,
    create, ddp, dedupe, deprecate, dist-tag, docs, doctor,
    edit, explore, fund, get, help, help-search, hook, i, init,
    install, install-ci-test, install-test, it, link, list, ln,
    login, logout, ls, orgtdated, owner, pack, ping, prefix,
    profile, prune, publish, rb, rebuild, repo, restart, root,
    run, run-script, s, se, search, set, shrinkwrap, star,
    stars, start, stop, t, team, test, token, tst, un,
    uninstall, unpublish, unstar, up, update, v, version, view,
    whoami

npm <command> -h  quick help on <command>
npm -l      display full usage info
npm help <term>   search for help on <term>
npm help npm   involved overview

Specify configs in the ini-formatted file:
    C:\Users\keefe\.npmrc
or on the command line via: npm <command> --key value
Config info can be viewed via: npm help config

npm@6.13.2 C:\Users\keefe\AppData\Roaming\npm\node_modules\npm

# aliases：命令别名
$ npm run --help
npm run-script <command> [-- <args>...]

aliases: run, rum, urn

$ npm install --help
npm install (with no args, in package dir)
npm install [<@scope>/]<pkg>
npm install [<@scope>/]<pkg>@<tag>
npm install [<@scope>/]<pkg>@<version>
npm install [<@scope>/]<pkg>@<version range>
npm install <alias>@npm:<name>
npm install <folder>
npm install <tarball file>
npm install <tarball url>
npm install <git:// url>
npm install <github username>/<github project>

aliases: i, isntall, add
common options: [--save-prod|--save-dev|--save-optional] [--save-exact] [--no-save]
```

备注： 

* npm init 会产生初始的package.json
* npm run xx 是最常用，用来启动各种命令如dev(热更新代码，用于开发环境)  build(构建生产版本)  lint ...
* npm install  安装依赖于package.json,  注意是--save-dev 还是 -g，默认是--save-dev 保存在当前路径
* npm ci  类似install，冻结安装，依赖于package.json.lock，安装更快也更严谨。
* npm list/npm show -g  列出npm所有安装的包, 
* npm show xxx  列出某个包的详细情况 
* npm root -g 查看全局安装路径



**npm配置项**

```shell
# 列出 npm主要配置项
$ npm config list
; cli configs
metrics-registry = "https://registry.npm.taobao.org/"
scope = ""
user-agent = "npm/6.14.11 node/v10.24.0 win32 x64"

; project config D:\mydocs\repos\script-langs\toolkit\etc\.npmrc
cache = "C:\\Users\\qfwud\\nodejs\\node_cache"
prefix = "C:\\Users\\qfwud\\nodejs\\node_global"
registry = "https://registry.npm.taobao.org/"

; userconfig C:\Users\qfwud\.npmrc
cache = "C:\\Users\\qfwud\\nodejs\\node_cache"
prefix = "C:\\Users\\qfwud\\nodejs\\node_global"
registry = "https://registry.npm.taobao.org/"

; node bin location = D:\dev\langs\nodejs\node-v10.24.0-win-x64\node.exe
; cwd = D:\mydocs\repos\script-langs\toolkit\etc
; HOME = C:\Users\qfwud
; "npm config ls -l" to show all defaults.

# 列出 npm所有可配置信息
$ npm config list --json
{
  "json": true,
  "user-agent": "npm/6.14.11 node/v10.24.0 win32 x64",
  "metrics-registry": "https://registry.npm.taobao.org/",
  "scope": "",
  "prefix": "C:\\Users\\qfwud\\nodejs\\node_global",
  "cache": "C:\\Users\\qfwud\\nodejs\\node_cache",
  "registry": "https://registry.npm.taobao.org/",
  "access": null,
  "allow-same-version": false,
  "always-auth": false,
  "also": null,
  "audit": true,
  "audit-level": "low",
  "auth-type": "legacy",
  "before": null,
  "bin-links": true,
  "browser": null,
  "ca": null,
  "cache-lock-stale": 60000,
  "cache-lock-retries": 10,
  "cache-lock-wait": 10000,
  "cache-max": null,
  "cache-min": 10,
  "cert": null,
  "cidr": null,
  "color": true,
  "depth": null,
  "description": true,
  "dev": false,
  "dry-run": false,
  "editor": "notepad.exe",
  "engine-strict": false,
  "force": false,
  "format-package-lock": true,
  "fund": true,
  "fetch-retries": 2,
  "fetch-retry-factor": 10,
  "fetch-retry-mintimeout": 10000,
  "fetch-retry-maxtimeout": 60000,
  "git": "git",
  "git-tag-version": true,
  "commit-hooks": true,
  "global": false,
  "globalconfig": "C:\\Users\\qfwud\\nodejs\\node_global\\etc\\npmrc",
  "global-style": false,
  "group": 0,
  "ham-it-up": false,
  "heading": "npm",
  "if-present": false,
  "ignore-prepublish": false,
  "ignore-scripts": false,
  "init-module": "C:\\Users\\qfwud\\.npm-init.js",
  "init-author-name": "",
  "init-author-email": "",
  "init-author-url": "",
  "init-version": "1.0.0",
  "init-license": "ISC",
  "key": null,
  "legacy-bundling": false,
  "link": false,
  "loglevel": "notice",
  "logs-max": 10,
  "long": false,
  "maxsockets": 50,
  "message": "%s",
  "node-options": null,
  "node-version": "10.24.0",
  "offline": false,
  "onload-script": null,
  "only": null,
  "optional": true,
  "otp": null,
  "package-lock": true,
  "package-lock-only": false,
  "parseable": false,
  "prefer-offline": false,
  "prefer-online": false,
  "preid": "",
  "production": false,
  "progress": true,
  "proxy": null,
  "https-proxy": null,
  "noproxy": null,
  "read-only": false,
  "rebuild-bundle": true,
  "rollback": true,
  "save": true,
  "save-bundle": false,
  "save-dev": false,
  "save-exact": false,
  "save-optional": false,
  "save-prefix": "^",
  "save-prod": false,
  "script-shell": null,
  "scripts-prepend-node-path": "warn-only",
  "searchopts": "",
  "searchexclude": null,
  "searchlimit": 20,
  "searchstaleness": 900,
  "send-metrics": false,
  "shell": "C:\\Windows\\system32\\cmd.exe",
  "shrinkwrap": true,
  "sign-git-commit": false,
  "sign-git-tag": false,
  "sso-poll-frequency": 500,
  "sso-type": "oauth",
  "strict-ssl": true,
  "tag": "latest",
  "tag-version-prefix": "v",
  "timing": false,
  "tmp": "C:\\Users\\qfwud\\AppData\\Local\\Temp",
  "unicode": false,
  "unsafe-perm": true,
  "update-notifier": true,
  "usage": false,
  "user": 0,
  "userconfig": "C:\\Users\\qfwud\\.npmrc",
  "umask": 0,
  "version": false,
  "versions": false,
  "viewer": "browser",
  "globalignorefile": "C:\\Users\\qfwud\\nodejs\\node_global\\etc\\npmignore"
}
```



**npm安装扩展模块**
npm 的包安装分为本地安装（local）、全局安装（global）两种。可以用`npm root [-g|]` 查看安装路径。

* 本地安装（local）：分--save(**无参数时默认**) 和 --save-dev。安装路径在 ./node_modules 下（运行 npm 命令时所在的目录）。
* 全局安装（global）：-g，默认安装路径在~/.node_modules下（以配置文件.npmrc为准，通常推荐安装webpack, webpack-dev-server, babel）。 

示例安装 

```python
# 安装到全局环境
npm install 依赖包[@版本号] -g 
# 安装到当前环境并添加到package.json的dependencies部分
npm install 依赖包[@版本号] --save
# 安装到当前环境并添加到package.json的devDependencies部分
npm install 依赖包[@版本号] --save-dev
```

npm配置文件 [.npmrc ](https://www.npmjs.cn/files/npmrc/)

```ini
prefix=~\nodejs\node_global
cache=~\nodejs\node_cache
registry=https://registry.npm.taobao.org/
```



#### npm常用模块

packae.json里的组件版本含义

* “5.0.3” 表示安装指定的5.0.3版本，
* “～5.0.3” 表示安装5.0.X中最新的版本，
* “^5.0.3” 表示安装5.X.X中最新的版本。
* ">= 5.0.3 < 5.1.0" 表示安装在5.0.3到5.1.0之间的版本。



表格 npm常用扩展模块

| 框架    | 模块名        | 说明                                                         | 使用                                                       |
| ------- | ------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| vue     | vue           | 脚手架，快速搭建开发环境。用来生成模板的vue工程。            | import Vue from 'vue'                                      |
|         | 组件经典组合  | vue-cli + vue-router(路由) + vue-x(扩展)                     | import VueRouter from "vue-router"                         |
|         | vue-resource  |                                                              | import VueResource from 'vue-resource'                     |
| react   | react         | react框架核心模块。                                          |                                                            |
|         | 组件经典组合  | react-dom +  react-router(路由) + react-redux(扩展)          |                                                            |
|         | react-scripts | react脚本，用来构建脚本命令。使用在package.json。            |                                                            |
| express | express       | 基于node.js的框架。脚手架。<br>它提供了一套强大的功能来开发Web和移动应用程序。 | var express = require('express');<br/>var app = express(); |
| 其它    | D3.js         | 数据可视化前端开发包。                                       | 安装：bower install d3 --save                              |
|         | eCharts       | 百度开源的数据可视化前端开发包。                             |                                                            |
|         | Yeoman        | 脚手架。                                                     | 安装：npm install -g yo                                    |
|         | gh-pages      | 文档构建和部署                                               |                                                            |
|         | ejs           | 模板引擎                                                     |                                                            |
|         | github        | github   api                                                 |                                                            |

备注：参数选项--save-dev为保存到开发目录（即当前目录，缺省选项。同时会写入到package.json里的devDependencies; --save写入到Dependencies ），-g 保存到全局目录。

1. npm包安装： npm/cnpm install [npm] --save-dev

2. 前端相关的包安装:  bower install [npm] --saves



表格 前端工程化所需的npm模块

| 工具            | 模块                 | 说明                                                         |
| --------------- | -------------------- | ------------------------------------------------------------ |
| webpack         | webpack              | 可以构建打包。配置文件webpack.config.js                      |
|                 | webpack-dev-server   | 基于Express框架的Node.js服务器。它还提供了一个客户端的运行环境，会被注入到页面代码中执行，并通过Socket.IO与服务器通信。<br/>服务器端的每次改动与重新构建都会被通知到页面上。还提供了如模块替换这样强大的功能。 |
| babel           | babel-core           | bable转化JS。配置文件.babelrc                                |
|                 | babel-preset-es2015  | babel的ES6语法包                                             |
|                 | babel-preset-react   | babel的React语法包                                           |
|                 | babel-runtime        |                                                              |
| eslint          | eslint               | 最新版本@3.19.0。配置文件.eslintrc.js                        |
|                 | eslint-config-airbnb | ESLint的第三方配置规则eslint-config-airbnb<br>依赖3个插件：eslint-plugin-import eslint-plugin-react eslint-plugin-jsx-a11y |
| Webpack -loader |                      | loader专注于处理资源内容。Webpack 默认只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。<br>插件：eslint-loader  babel-loader  style-loader css-loader less-loader sass-loader file-loader url-loader |
| Webpack -plugin |                      | plugin可以实现那些loader实现不了或者不适合在loader实现的功能，比如自动生成项目的HTML页面、向构建过程中注入环境变量等。<br>插件：html-webpack-plugin  uglifyjs-webpack-plugin |
|                 | clean-webpack-plugin | 清除webpack之前打包的文件。                                  |
| tools           | cross-env            | 设置环境变量，兼容windows和linux。示例 `cross-env NODE-ENV=prod` |

备注：用于开发 `npm instlal  xx  --save-dev`



#### **npm常见问题**

**Q1:  cygpath command not found**

描述： 

原因：cygwin兼容性问题。

解决方法：



**Q2：npm安装过程失败，重新安装总失败**

原因：需要清除缓存

解决方法：1.先删除node_module目录; 2.清除cache

```shell
$ rm -rf node_modules
$ npm cache clean --force
$ npm install -d  #开发模式安装，会安装dependencies和devDependencies，安装模块会更多些
$ npm run dev  #开发模式运行，即时编译，有修改即会触发编译。发布到生产时可用npm run build
```



**Q3： 解决linux下nodejs中watch文件最大数异常**

描述：

```shell
ENOSPC: System limit for number of file watchers reached
```

解决方法：

```shell
$ echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
```



### nvm

官网：http://nvm.sh/ -> https://github.com/nvm-sh/nvm/blob/master/README.md

nvm可用来管理nodejs的多个版本。

```sh
# 安装nvm
$ npm install -g nvm

# 安装特定版本nodejs，并切换版本use
$ nvm install 6.14
$ nvm use 6.14

# 设置缺省nodejs版本
$ nvm alias default 8.1.0
```



### yarn

“Yarn是由Facebook、Google、Exponent 和 Tilde 联合推出了一个新的 JS 包管理工具 ，正如[官方文档](https://link.jianshu.com?t=http%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%3A%2F%2Fcode.facebook.com%2Fposts%2F1840075619545360)中写的，Yarn 是为了弥补 npm 的一些缺陷而出现的。

Yarn的优势  

* 速度更快
* 版本统一，冻结安装，依赖于package.json.lock，永远不修改package.json
* 更简洁输出
* 多安装源
* 更好的语义化命令



表格 Yarn和npm命令对比

|                          npm | yarn                 |
| ---------------------------: | :------------------- |
|                  npm install | yarn                 |
|     npm install react --save | yarn add react       |
|   npm uninstall react --save | yarn remove react    |
| npm install react --save-dev | yarn add react --dev |
|            npm update --save | yarn upgrade         |



### webpack

官网：https://webpack.js.org/

github仓库：https://github.com/webpack/webpack

**webpack** 是一个用于现代 JavaScript 应用程序的 *静态模块打包工具*。当 webpack 处理应用程序时，它会在内部构建一个 [依赖图(dependency graph)](https://webpack.docschina.org/concepts/dependency-graph/)，此依赖图对应映射到项目所需的每个模块，并生成一个或多个 *bundle*。

**webpack命令**

```shell
$ webpack --help
Usage: webpack [entries...] [options]
Alternative usage to run commands: webpack [command] [options]

The build tool for modern web applications.

Options:
  -c, --config <value...>                Provide path to a webpack configuration file e.g. ./webpack.config.js.
  --config-name <value...>               Name of the configuration to use.
  -m, --merge                            Merge two or more configurations using 'webpack-merge'.
  --env <value...>                       Environment passed to the configuration when it is a function.
  --node-env <value>                     Sets process.env.NODE_ENV to the specified value.
  --progress [value]                     Print compilation progress during build.
  -j, --json [value]                     Prints result as JSON or store it in a file.
  -d, --devtool <value>                  Determine source maps to use.
  --no-devtool                           Do not generate source maps.
  --entry <value...>                     The entry point(s) of your application e.g. ./src/main.js.
  --mode <value>                         Defines the mode to pass to webpack.
  --name <value>                         Name of the configuration. Used when loading multiple configurations.
  -o, --output-path <value>              Output location of the file generated by webpack e.g. ./dist/.
  --stats [value]                        It instructs webpack on how to treat the stats e.g. verbose.
  --no-stats                             Disable stats output.
  -t, --target <value...>                Sets the build target e.g. node.
  --no-target                            Negative 'target' option.
  -w, --watch                            Watch for files changes.
  --no-watch                             Do not watch for file changes.
  --watch-options-stdin                  Stop watching when stdin stream has ended.
  --no-watch-options-stdin               Do not stop watching when stdin stream has ended.

Global options:
  --color                                Enable colors on console.
  --no-color                             Disable colors on console.
  -v, --version                          Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  -h, --help [verbose]                   Display help for commands and options.

Commands:
  build|bundle|b [entries...] [options]  Run webpack (default command, can be omitted).
  configtest|t [config-path]             Validate a webpack configuration.
  help|h [command] [option]              Display help for commands and options.
  info|i [options]                       Outputs information about your system.
  serve|server|s [entries...] [options]  Run the webpack dev server.
  version|v [commands...]                Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  watch|w [entries...] [options]         Run webpack and watch for files changes.

To see list of all supported commands and options run 'webpack --help=verbose'.

Webpack documentation: https://webpack.js.org/.
CLI documentation: https://webpack.js.org/api/cli/.
Made with ? by the webpack team.
```



#### webpack用户篇

**核心概念**：

- [入口(entry)](https://webpack.docschina.org/concepts/#entry)： 指示 webpack 应该使用哪个模块，来作为构建其内部 依赖图(dependency graph) 的开始。
- [输出(output)](https://webpack.docschina.org/concepts/#output)  告诉 webpack 在哪里输出它所创建的 *bundle*，以及如何命名这些文件。主要输出文件的默认值是 `./dist/main.js`，其他生成文件默认放置在 `./dist` 文件夹中。
- [loader](https://webpack.docschina.org/concepts/#loaders):  定义规则处理js/json之外的文件要用到的loader
- [插件(plugin)](https://webpack.docschina.org/concepts/#plugins)：插件目的在于解决 [loader](https://www.webpackjs.com/concepts/loaders) 无法实现的**其他事**。webpack **插件**是一个具有 [`apply`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply) 属性的 JavaScript 对象。`apply` 属性会被 webpack compiler 调用，并且 compiler 对象可在**整个**编译生命周期访问。
- [模式(mode)](https://webpack.docschina.org/concepts/#mode)： 环境参数，选择 `development`, `production` 或 `none` 之中的一个，默认production
- [浏览器兼容性(browser compatibility)](https://webpack.docschina.org/concepts/#browser-compatibility)
- [环境(environment)](https://webpack.docschina.org/concepts/#environment)  webpack 5 运行于 Node.js v10.13.0+ 的版本。
- 模块：离散功能块(discrete chunks of functionality)。每个模块具有比完整程序更小的接触面，使得校验、调试、测试轻而易举。



**webpack.config.js 示例**

```js
const path = require('path');

module.exports = {
  entry: './path/to/my/entry/file.js',   //入口，可以指向字符串（SAP）或一个字典（多页面）
  output: {	//输出
    path: path.resolve(__dirname, 'dist'),
    filename: 'my-first-webpack.bundle.js',
  },

  module: {  
    //loader: txt文件用raw-loader, jsx文件用babel解析
    rules: [{ test: /\.txt$/, use: 'raw-loader' }，
			{ test: /\.jsx$/, exclude:/node_modules/, loaders:['babel'] },             
           ],      
  },    
  plugins: [new HtmlWebpackPlugin({ template: './src/index.html' })],  //插件    
  mode: 'production',    
};
```



**安装webpack loader**

Webpack有一个不可不说的优点，它把所有的文件都可以当做模块处理，包括你的JavaScript代码，也包括CSS和fonts以及图片等等等，只有通过合适的loaders，它们都可以被当做模块被处理。
Webpack 默认只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。

安装eslint-loader整合eslint：

```q
npm install eslint-loader --save-dev
```

安装babel-loader整合babel：

```mipsasm
npm install babel-loader --save-dev
```

安装style-loader css-loader等，转换对应类型文件：

```brainfuck
npm install style-loader css-loader less-loader sass-loader file-loader url-loader --save-dev
```

css-loader 用于打包css文件
style-loader 用于将编译完成的css插入html中
less-loader 是将less文件编译成css
sass-loader 是将sass文件编译成css
file-loader 用于打包文件
url-loadder 用于打包图片

webpack提供两个工具处理样式表，css-loader 和 style-loader，二者处理的任务不同，css-loader使你能够使用类似@import 和 url(...)的方法实现 require()的功能,style-loader将所有的计算后的样式加入页面中，二者组合在一起使你能够把样式表嵌入webpack打包后的JS文件中。
url-loader是对file-loader的上层封装。一般限制小图片直接转成 base64 可以用 url-loader，其他情况都用 file-loader。



**安装webpack plugin**

与loader专注于处理资源内容不同，plugin功能更广更强大。plugin可以实现那些loader实现不了或者不适合在loader实现的功能，比如自动生成项目的HTML页面、向构建过程中注入环境变量等。

常用插件：html-webpack-plugin  uglifyjs-webpack-plugin（用于JS代码压缩）



**hash、chunkhash和contenthash**

* hash:  跟整个项目的构建相关，同一次构建过程中生成的hash都是一样的。只要项目里有文件更改，整个项目构建的hash值都会更改；没有文件更改，重新构建，生成HASH值也不一样。主要用于开发模式，客户端缓存都会失效。
* **chunkhash**：即模块hash。根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的hash值。只要文件内容没有更改就不会重复构建。如果公共库是单独模块，不修改公共库文件；非公共库文件修改后，重新构建非公共库模块，原公共库模块缓存仍能使用。
* contenthash： 表示由文件内容产生的hash值，内容不同产生的contenthash值也不一样。在项目中，通常做法是把项目中css都抽离出对应的css文件来加以引用。



#### webpack版本差异

[版本迁移指南](https://webpack.js.org/migrate/) https://webpack.docschina.org/migrate/

**前提条件**

在开始之前，请确保安装了 [Node.js](https://nodejs.org/en/) 的最新版本。使用 Node.js 最新的长期支持版本(LTS - Long Term Support)，是理想的起步。使用旧版本，你可能遇到各种问题，因为它们可能缺少 webpack 功能以及/或者缺少相关 package 包。

| 版本    | 发布时间   | npm版本要求 | 说明                                                         |
| ------- | ---------- | ----------- | ------------------------------------------------------------ |
| 1.0     | 2012-03    |             | 略                                                           |
| 2.0     |            |             | webpack 2.0之后，不能省略后缀-loader。 <br>1.新增对`ES6`语法的支持.<br>2.支持`tree-shaking` ( 减少打包后的体积 )<br>3.更新`resolve`的写法: resolve.modulesDirectories => resolve.modules<BR>4.修改module配置：外层loaders改为rules; 内层loader改为use; 所有插件必须加上 -loader，不再允许缩写; 不再支持使用!连接插件，改为数组形式; json-loader模块移除，webpack会自动处理.<br>5.移除部分plugins: 移除了OccurenceOrderPlugin、NoErrorsPlugin插件，改为内置插件 |
| 3.0     | 2017-06-20 |             | 1.Scope Hoisting : 作用域，将 function closures的包裹方式变成了可配置的形式。<br>2.Magic Comments 魔法注释（内联注释）。<br>3.新增内置插件webpack-dev-server |
| 4.0     | 2018-02-26 | 6.11.5+     | webpack 4+ 版本，还需要安装 CLI(webpack-cli)，可以不用引入一个配置文件。<br>1.mode配置选项。<br/>2.Loader使用规则：废弃loaders写法，只支持rules。<br/>3.babek使用新的命名规则@babel。<br/>4.CommonsChunkPlugin：代码拆分插件。<br/>5.新增ini-css-extract-plugin: css代码抽离插件。把css从js文件中抽离，防止js太大，加载时间太长。<br/>6.UglifyJsPlugin：js代码压缩插件。production mode下面自动为true，optimization.minimizer可以进行个性化配置。<br/>7.happypack：多进程loader打包.当开启时，子进程执行，结果发给父进程。 |
| 5.0     | 2020-10-10 | 10.13.0+    | 1.针对 `production` 模式进行了优化<BR>2. ...                 |
| Roadmap |            |             |                                                              |

更改比较多的配置示例

```shell
# webpack 1.X：

# webpack 2.X：

# webpack 3.X：

# webpack 4.X：
const { mode } = require("webpack-nano/argv");
const {
  MiniHtmlWebpackPlugin,
} = require("mini-html-webpack-plugin");
const { WebpackPluginServe } = require("webpack-plugin-serve");

module.exports = {
  watch: mode === "development",
  entry: ["./src", "webpack-plugin-serve/client"],
  mode,
  plugins: [
    new MiniHtmlWebpackPlugin({ context: { title: "Demo" } }),
    new WebpackPluginServe({
      port: process.env.PORT || 8080,
      static: "./dist",
      liveReload: true,
      waitForBuild: true,
    }),
  ],
};
```

webpack@4以后的版本，弃用了许多@3的插件，其中包括：
分离打包js文件的插件 webpack.optimize.CommonChunkPlugin()；
压缩js文件的插件 webpack.optimize.UglifyJsPlugin();
定义产品上线环境 webpack.optimize.DedupePlugun()；
分离css文件插件 extract-text-webpack-plugin();
css文件压缩插件 CssMinimizerPlugin()；



### babel

JavaScript编译，将浏览器未实现的ECMAScript规范语法转化成可运行的低版本语法 。

我们使用 `@babel/cli` 从终端运行 Babel，利用 `@babel/polyfill` 来模拟所有新的 JavaScript 功能，而 `env` preset 只对我们所使用的并且目标浏览器中缺失的功能进行代码转换和加载 polyfill。

1. 安装

```sh
npm install --save-dev @babel/core @babel/cli @babel/preset-env
npm install --save @babel/polyfill
```

2. 配置：配置文件有多种，包括.babelrc, .babelrc.js,  babel.config.js

   * .babelrc：适用于单个软件包的配置

  ```js
{
  "presets": [...],
  "plugins": [...]
}
  ```

* .babelrc.js： 与 [`.babelrc`](https://www.babeljs.cn/docs/configuration#babelrc) 的配置相同，但你可以使用 JavaScript 编写。 

  ```js
const presets = [ ... ];
const plugins = [ ... ];

module.exports = { presets, plugins };
  ```

   * `babel.config.js`：项目根目录下，可编译node_modules目录下的模块。内容如下，

  ```js
const presets = [
  [
    "@babel/env",
    {
   targets: {
     edge: "17",
     firefox: "60",
     chrome: "67",
     safari: "11.1",
   },
   useBuiltIns: "usage",
    },
  ],
];

module.exports = { presets };
  ```

3. 运行此命令将 `src` 目录下的所有代码编译到 `lib` 目录： 

   `./node_modules/.bin/babel src --out-dir lib`



### gulp

https://www.gulpjs.com.cn/

gulp.js - 基于流(stream)的自动化构建工具。Grunt 采用配置文件的方式执行任务，而 [Gulp](https://www.gulpjs.com.cn/) 一切都通过代码实现。



### lerna

官网：https://github.com/lerna/lerna/

安装

```shell
# 安装 
$ npm install --global lerna

# 创建git仓库
$ git init lerna-repo && cd lerna-repo

# 将git仓库转化成lerna仓库
$ lerna init
$ cat lerna.json
{
  "packages": [
    "packages/*"
  ],
  "version": "0.0.0"
}
```

lerna 代码仓库结构 

```shell
lerna-repo/
  packages/
  package.json
  lerna.json
```





#  参考资料

**官网**

* nvm http://nvm.sh/  ->  https://github.com/nvm-sh/nvm/blob/master/README.md
* webpack https://webpack.js.org/   
* [Grunt](http://www.gruntjs.net/)  http://www.gruntjs.net/
* lerna  https://github.com/lerna/lerna/



**中文文档**

* webpack中文文档  https://webpack.docschina.org
* gulp.js  https://www.gulpjs.com.cn/





## 参考链接

* babel在线转换 "https://babeljs.io/repl/"
* 知乎ServerLess " https://zhuanlan.zhihu.com/p/65914436 "
* TS基础  https://blog.csdn.net/qq_39403733/article/details/93756705
* ts语法总结 https://blog.csdn.net/qq_15701939/article/details/83934608
* TypeScript 高级用法 https://www.cnblogs.com/cczlovexw/p/14389259.html
* Webpack 各版本 ( v1 - v4 ) 的区别 https://blog.csdn.net/Vue2018/article/details/106501629/



