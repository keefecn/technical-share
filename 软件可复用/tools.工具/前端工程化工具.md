| 序号 | 修改时间   | 修改内容                                                     | 修改人 | 审稿人 |
| ---- | ---------- | ------------------------------------------------------------ | ------ | ------ |
| 1    | 2021-11-18 | 创建。从《前端框架分析》相关章节迁移成文。增加webpack生态章节。 | Keefe  | Keefe  |
|      |            |                                                              |        |        |







---



[TOC]



---

## 1 前端工程化概述

前端开发过程产生的问题

1.　ECMAScript（ES）规范与浏览器兼容性不一致：想使用最新的ECMAScript规范进行开发，但受限于浏览器实现，需要适配旧规范。
2.　CSS的弱编程能力：想使用LESS/SASS等预编译语法或者PostCSS自动处理hack。
3.　资源定位：本地开发静态资源引用的是本地相对路径，上线前需要修改为真实URL。
4.　考虑产品性能：需要压缩静态资源，图片压缩/BASE64内嵌/CSS Sprites。
5.　模块依赖分析和压缩打包：模块化开发，提高维护效率。上线前模块需要进行依赖分析和合并打包。
6.　协作层面：前端依赖后端数据
7.　部署层面：静态文件（JS/CSS/图片）与动态文件(HTML模板)仍然存在于同一项目，前端部分资源仍然需要后端工程师部署。

说明：针对上面七大问题。前面五大是开发问题。



前端工程化流水线要经过大概四个阶段：脚手架 --> 构建 --> 本地开发服务器 --> 部署

| 阶段           | 目的                                                         | 功能                                                         | 典型工具                    |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------- |
| 脚手架         | 快速搭建前端基本环境，以聚焦业务。                           | 包括自动安装、统一工具栈等。                                 | [Yeoman](http://yeoman.io/) |
| <br/>构建      | 也叫编译。将源代码中转化成宿主浏览器能执行的代码。解决前端七大问题中的开发问题。 | 解决依赖打包、资源嵌入、文件压缩、HASH指纹等。构建还包括构建需要解决3类问题，分别是语言、优化和部署。 | webpack                     |
| 本地开发服务器 | 本地服务器最典型的应用是MOCK服务，通过模拟接口和数据解决前端JS对数据API的依赖问题，从而实现前后端并行开发。 | MOCK服务。<br>支持SSR（服务器端渲染）。<br>动态构建。        |                             |
| 部署           |                                                              |                                                              |                             |



表格 构建步骤的前端资源变化

| 源资源                                               | 构建后产出资源 | 构建动作             |
| ---------------------------------------------------- | -------------- | -------------------- |
| 领先于浏览器实现的ECMAScript规范编写的JS代码 (xx.es) | JS             | ECMAScript规范编转译 |
| LESS/SASS预编译语法编写的CSS代码 (xx.less)           | CSS            | CSS预编译语法转译    |
| Jade/EJS/Mustache等模板语法编写的HTML代码 (xx.jade)  | html           | HTML模板渲染         |



## 2 前端工具

表格  前端常用工具1

| 工具                                     | 简介                                                         | 安装                                                         | 使用                                   |
| ---------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------- |
| node.js                                  | 建立在谷歌Chrome的JavaScript引擎(V8引擎)的Web应用程序框架。  | `nvm install 5.1.0`   或者<br>`apt-get install nodejs`       | node -v                                |
| [npm](https://www.npmjs.com/)/   cnpm    | NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题。用来安装npm包。cnpm为中国区。 | `npm install -g cnpm --registry=https://registry.npm.taobao.org` | npm -v   npm install   [xxx]           |
| nvm                                      | node.js的包管理工具。                                        | curl -o https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh \| bash | nvm  --version   nvm install [version] |
| yarn                                     | 替代npm。为了弥补 npm 的一些缺陷而出现的。                   | npm install -g yarn                                          |                                        |
| webpack                                  | 模块打包工具。2012.3诞生。                                   | npm install webpack@xx -g                                    |                                        |
| babel                                    | Babel 是一个 JavaScript 编译器，是一个工具链。<br>主要用于将 ECMAScript 2015+ 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。（ES转译） |                                                              |                                        |
| [Gulp](https://www.gulpjs.com.cn/)       | 2012.3诞生。基于 Node.js 的项目、流(stream)的自动化构建工具。<br/>Grunt 采用配置文件的方式执行任务，而 [Gulp](https://www.gulpjs.com.cn/) 一切都通过代码实现。 | npm install gulp -g                                          | gulp [js_pipe]   gulp deploy           |
| [Grunt](http://www.gruntjs.net/)         | 2012.6诞生。Grunt 是基于 Node.js 的项目构建工具。<br>它可以自动运行你所设定的任务。Grunt 拥有数量庞大的插件。 | npm install -g grunt-cli                                     |                                        |
| bower                                    | npm包，前端管理工具，专门用来管理WEB前端依赖包（JS/CSS/IMAGES/fonts） | npm install bower<br>bower init 初始化生成bower.json         | bower install xx                       |
| n                                        | 用来管理nodejs版本。<br>查看nodejs版本：n lsr                | npm install -g n                                             | 安装指定版本：n xx                     |
| npx                                      | npm5.2+版本新增。npx 想要解决的主要问题，就是调用项目内部安装的模块。<br>运行的时候，会到`node_modules/.bin`路径和环境变量`$PATH`里面，检查命令是否存在。 |                                                              |                                        |
| [lerna](https://github.com/lerna/lerna/) | Lerna 是一种工具，针对使用 git 和 npm 管理多软件包代码仓库的工作流程进行优化 |                                                              |                                        |
| [Yeoman](http://yeoman.io)               | 脚手架                                                       | npm install -g yo                                            |                                        |

备注：cnpm类似npm，只是源在中国。



表格 前端常用工具2

| 工具名                                                       | 用途                                                         | 备注 |
| :----------------------------------------------------------- | ------------------------------------------------------------ | ---- |
| [PostCSS](https://www.postcss.com.cn/)                       | CSS预编译器。支持未来 CSS 语法、模块化、代码检测等。         |      |
| [LESS](https://www.bootcss.com/p/lesscss/)/[SASS](https://www.sasscss.com/) | CSS预编译语法转换。                                          |      |
| CommonJS                                                     | 面向浏览器以外的JavaScript模块化规范。原名ServeJS，2019年改现名，被Nodejs采纳为默认的模块化规范。 | 弃   |
| AMD/CMD                                                      | CommonJS的变种，主要针对浏览器环境的模板化规范。             | 弃   |
| ES6 Module                                                   | 规范的静态模块体系。                                         | 标准 |
| [ESLint](https://cn.eslint.org/)                             | ESLint 是一个插件化并且可配置的 JavaScript 语法规则和代码风格的检查工具。ESLint 能够帮你轻松写出高质量的 JavaScript 代码。 |      |

备注：模块化规范有三种分别是CommonJS、AMD/CMD和ES6 Module，任选其一即可。在ES6 Module推出后，另外二种退出舞台。



### npm&cnpm

npm是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：

- 允许用户从NPM服务器下载别人编写的第三方包到本地使用。

- 允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。

- 允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。

  ```sh
  # 查看当前版本
  $ npm -v

  # install后空是根据当前目录下的package.json安装；否则安装指定包，@版本号
  npm install
  npm install xx
  npm install xx@x.x

  # npm升级自身
  $ npm install npm -g
  ```



**cnpm**:  淘宝镜像的npm, 中国区用户速度更快

```shell
# 安装cnpm
$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org

# 或者 npm设置淘宝源
$ sudo npm config set registry https://registry.npm.taobao.org
```



**npm命令**

```sh
$ npm --help
Usage: npm <command>

where <command> is one of:
    access, adduser, audit, bin, bugs, c, cache, ci, cit,
    clean-install, clean-install-test, completion, config,
    create, ddp, dedupe, deprecate, dist-tag, docs, doctor,
    edit, explore, fund, get, help, help-search, hook, i, init,
    install, install-ci-test, install-test, it, link, list, ln,
    login, logout, ls, orgtdated, owner, pack, ping, prefix,
    profile, prune, publish, rb, rebuild, repo, restart, root,
    run, run-script, s, se, search, set, shrinkwrap, star,
    stars, start, stop, t, team, test, token, tst, un,
    uninstall, unpublish, unstar, up, update, v, version, view,
    whoami

npm <command> -h  quick help on <command>
npm -l      display full usage info
npm help <term>   search for help on <term>
npm help npm   involved overview

Specify configs in the ini-formatted file:
    C:\Users\keefe\.npmrc
or on the command line via: npm <command> --key value
Config info can be viewed via: npm help config

npm@6.13.2 C:\Users\keefe\AppData\Roaming\npm\node_modules\npm

# aliases：命令别名
$ npm run --help
npm run-script <command> [-- <args>...]

aliases: run, rum, urn

$ npm install --help
npm install (with no args, in package dir)
npm install [<@scope>/]<pkg>
npm install [<@scope>/]<pkg>@<tag>
npm install [<@scope>/]<pkg>@<version>
npm install [<@scope>/]<pkg>@<version range>
npm install <alias>@npm:<name>
npm install <folder>
npm install <tarball file>
npm install <tarball url>
npm install <git:// url>
npm install <github username>/<github project>

aliases: i, isntall, add
common options: [--save-prod|--save-dev|--save-optional] [--save-exact] [--no-save]
```

备注：

* npm init 会产生初始的package.json
* npm run xx 是最常用，用来启动各种命令如dev(热更新代码，用于开发环境)  build(构建生产版本)  lint ...
* npm install  安装依赖于package.json,  注意是--save-dev 还是 -g，默认是--save-dev 保存在当前路径
* npm ci  类似install，冻结安装，依赖于package.json.lock，安装更快也更严谨。
* npm list/npm show -g  列出npm所有安装的包,
* npm show xxx  列出某个包的详细情况
* npm root -g  查看全局安装路径
* npm config ls   列举出npm基本配置信息



**npm配置项**

```shell
# 列出 npm主要配置项
$ npm config list
; cli configs
metrics-registry = "https://registry.npm.taobao.org/"
scope = ""
user-agent = "npm/6.14.11 node/v10.24.0 win32 x64"

; project config ~\repos\script-langs\toolkit\etc\.npmrc
cache = "C:\\Users\\keefe\\nodejs\\node_cache"
prefix = "C:\\Users\\keefe\\nodejs\\node_global"
registry = "https://registry.npm.taobao.org/"

; userconfig C:\Users\keefe\.npmrc
cache = "C:\\Users\\keefe\\nodejs\\node_cache"
prefix = "C:\\Users\\keefe\\nodejs\\node_global"
registry = "https://registry.npm.taobao.org/"

; node bin location = D:\dev\langs\nodejs\node-v10.24.0-win-x64\node.exe
; cwd = ~\repos\script-langs\toolkit\etc
; HOME = C:\Users\keefe
; "npm config ls -l" to show all defaults.

# 列出 npm所有可配置信息
$ npm config list --json
{
  "json": true,
  "user-agent": "npm/6.14.11 node/v10.24.0 win32 x64",
  "metrics-registry": "https://registry.npm.taobao.org/",
  "scope": "",
  "prefix": "C:\\Users\\keefe\\nodejs\\node_global",
  "cache": "C:\\Users\\keefe\\nodejs\\node_cache",
  "registry": "https://registry.npm.taobao.org/",
  "access": null,
  "allow-same-version": false,
  "always-auth": false,
  "also": null,
  "audit": true,
  "audit-level": "low",
  "auth-type": "legacy",
  "before": null,
  "bin-links": true,
  "browser": null,
  "ca": null,
  "cache-lock-stale": 60000,
  "cache-lock-retries": 10,
  "cache-lock-wait": 10000,
  "cache-max": null,
  "cache-min": 10,
  "cert": null,
  "cidr": null,
  "color": true,
  "depth": null,
  "description": true,
  "dev": false,
  "dry-run": false,
  "editor": "notepad.exe",
  "engine-strict": false,
  "force": false,
  "format-package-lock": true,
  "fund": true,
  "fetch-retries": 2,
  "fetch-retry-factor": 10,
  "fetch-retry-mintimeout": 10000,
  "fetch-retry-maxtimeout": 60000,
  "git": "git",
  "git-tag-version": true,
  "commit-hooks": true,
  "global": false,
  "globalconfig": "C:\\Users\\keefe\\nodejs\\node_global\\etc\\npmrc",
  "global-style": false,
  "group": 0,
  "ham-it-up": false,
  "heading": "npm",
  "if-present": false,
  "ignore-prepublish": false,
  "ignore-scripts": false,
  "init-module": "C:\\Users\\keefe\\.npm-init.js",
  "init-author-name": "",
  "init-author-email": "",
  "init-author-url": "",
  "init-version": "1.0.0",
  "init-license": "ISC",
  "key": null,
  "legacy-bundling": false,
  "link": false,
  "loglevel": "notice",
  "logs-max": 10,
  "long": false,
  "maxsockets": 50,
  "message": "%s",
  "node-options": null,
  "node-version": "10.24.0",
  "offline": false,
  "onload-script": null,
  "only": null,
  "optional": true,
  "otp": null,
  "package-lock": true,
  "package-lock-only": false,
  "parseable": false,
  "prefer-offline": false,
  "prefer-online": false,
  "preid": "",
  "production": false,
  "progress": true,
  "proxy": null,
  "https-proxy": null,
  "noproxy": null,
  "read-only": false,
  "rebuild-bundle": true,
  "rollback": true,
  "save": true,
  "save-bundle": false,
  "save-dev": false,
  "save-exact": false,
  "save-optional": false,
  "save-prefix": "^",
  "save-prod": false,
  "script-shell": null,
  "scripts-prepend-node-path": "warn-only",
  "searchopts": "",
  "searchexclude": null,
  "searchlimit": 20,
  "searchstaleness": 900,
  "send-metrics": false,
  "shell": "C:\\Windows\\system32\\cmd.exe",
  "shrinkwrap": true,
  "sign-git-commit": false,
  "sign-git-tag": false,
  "sso-poll-frequency": 500,
  "sso-type": "oauth",
  "strict-ssl": true,
  "tag": "latest",
  "tag-version-prefix": "v",
  "timing": false,
  "tmp": "C:\\Users\\keefe\\AppData\\Local\\Temp",
  "unicode": false,
  "unsafe-perm": true,
  "update-notifier": true,
  "usage": false,
  "user": 0,
  "userconfig": "C:\\Users\\keefe\\.npmrc",
  "umask": 0,
  "version": false,
  "versions": false,
  "viewer": "browser",
  "globalignorefile": "C:\\Users\\keefe\\nodejs\\node_global\\etc\\npmignore"
}
```



**npm安装扩展模块**
npm 的包安装分为本地安装（local）、全局安装（global）两种。可以用`npm root [-g|]` 查看安装路径。

* 本地安装（local）：分--save(**无参数时默认**) 和 --save-dev。安装路径在 ./node_modules 下（运行 npm 命令时所在的目录）。
* 全局安装（global）：-g，默认安装路径在~/.node_modules下（以配置文件.npmrc为准，通常推荐安装webpack, webpack-dev-server, babel）。

示例安装

```python
# 安装到全局环境
npm install 依赖包[@版本号] -g
# 安装到当前环境并添加到package.json的dependencies部分
npm install 依赖包[@版本号] --save
# 安装到当前环境并添加到package.json的devDependencies部分
npm install 依赖包[@版本号] --save-dev
```

npm配置文件 [.npmrc ](https://www.npmjs.cn/files/npmrc/)

```ini
prefix=~\nodejs\node_global
cache=~\nodejs\node_cache
registry=https://registry.npm.taobao.org/
```



#### npm常用模块

packae.json里的组件版本含义

* “5.0.3” 表示安装指定的5.0.3版本，
* “～5.0.3” 表示安装5.0.X中最新的版本，`npm install npm@5.0 -g`
* “^5.0.3” 表示安装5.X.X中最新的版本。 `npm install npm@5 -g`
* ">= 5.0.3 < 5.1.0" 表示安装在5.0.3到5.1.0之间的版本。



表格 npm常用扩展模块

| 框架    | 模块名                       | 说明                                                         | 使用                                                       |
| ------- | ---------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| vue     | vue                          | 脚手架，快速搭建开发环境。用来生成模板的vue工程。            | import Vue from 'vue'                                      |
|         | 组件经典组合                 | vue-cli + vue-router(路由) + vue-x(扩展)                     | import VueRouter from "vue-router"                         |
|         | vue-resource                 |                                                              | import VueResource from 'vue-resource'                     |
| react   | react                        | react框架核心模块。                                          |                                                            |
|         | 组件经典组合                 | react-dom +  react-router(路由) + react-redux(扩展)          |                                                            |
|         | react-scripts                | react脚本，用来构建脚本命令。使用在package.json。            |                                                            |
| express | express                      | 基于node.js的框架。脚手架。<br>它提供了一套强大的功能来开发Web和移动应用程序。 | var express = require('express');<br/>var app = express(); |
| 其它    | D3.js                        | 数据可视化前端开发包。                                       | 安装：bower install d3 --save                              |
|         | eCharts                      | 百度开源的数据可视化前端开发包。                             |                                                            |
|         | [Yeoman](https://yeoman.io/) | 脚手架。                                                     | 安装：npm install -g yo                                    |
|         | gh-pages                     | 文档构建和部署                                               |                                                            |
|         | ejs                          | 模板引擎                                                     |                                                            |
|         | github                       | github   api                                                 |                                                            |

备注：参数选项--save-dev为保存到开发目录（即当前目录，缺省选项。同时会写入到package.json里的devDependencies; --save写入到Dependencies ），-g 保存到全局目录。

1. npm包安装： npm/cnpm install [npm] --save-dev

2. 前端相关的包安装:  bower install [npm] --saves



表格 前端工程化所需的npm模块

| 工具            | 模块                 | 说明                                                         |
| --------------- | -------------------- | ------------------------------------------------------------ |
| webpack         | webpack              | 可以构建打包。配置文件webpack.config.js                      |
|                 | webpack-dev-server   | 基于Express框架的Node.js服务器。它还提供了一个客户端的运行环境，会被注入到页面代码中执行，并通过Socket.IO与服务器通信。<br/>服务器端的每次改动与重新构建都会被通知到页面上。还提供了如模块替换这样强大的功能。 |
| babel           | babel-core           | bable转化JS。配置文件.babelrc                                |
|                 | babel-preset-es2015  | babel的ES6语法包                                             |
|                 | babel-preset-react   | babel的React语法包                                           |
|                 | babel-runtime        |                                                              |
| eslint          | eslint               | 最新版本@3.19.0。配置文件.eslintrc.js                        |
|                 | eslint-config-airbnb | ESLint的第三方配置规则eslint-config-airbnb<br>依赖3个插件：eslint-plugin-import eslint-plugin-react eslint-plugin-jsx-a11y |
| Webpack -loader |                      | loader专注于处理资源内容。Webpack 默认只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。<br>插件：eslint-loader  babel-loader  style-loader css-loader less-loader sass-loader file-loader url-loader |
| Webpack -plugin |                      | plugin可以实现那些loader实现不了或者不适合在loader实现的功能，比如自动生成项目的HTML页面、向构建过程中注入环境变量等。<br>插件：html-webpack-plugin  uglifyjs-webpack-plugin |
|                 | clean-webpack-plugin | 清除webpack之前打包的文件。                                  |
| tools           | cross-env            | 设置环境变量，兼容windows和linux。示例 `cross-env NODE-ENV=prod` |

备注：用于开发 `npm instlal  xx  --save-dev`



#### **npm常见问题**

**Q1:  cygpath command not found**

描述：windows cygwin环境报上面错，`cygpath command not found`

原因：cygwin兼容性问题。

解决方法：



**Q2：npm安装过程失败，重新安装总失败**

原因：需要清除缓存

解决方法：1.先删除node_module目录。2.清除cache或不使用cache  --no-cache-dir

```shell
$ rm -rf node_modules
$ npm cache clean --force
$ npm install -d  #开发模式安装，会安装dependencies和devDependencies，安装模块会更多些
$ npm run dev  #开发模式运行，即时编译，有修改即会触发编译。发布到生产时可用npm run build
```



**Q3： 解决linux下nodejs中watch文件最大数异常**

描述：

```shell
ENOSPC: System limit for number of file watchers reached
```

解决方法：

```shell
$ echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
```



**Q4： moduleName is declared but its value is never read**

描述：TS6133: xx is declared but its value is never read. 出现在typescript类型里。

解决方法：TS类型检测报警。若要真正解决，声明了变量就要使用，否则移除。

**不报此警告的解决方法**

法1：在错误语句后面添加注释 `// eslint-disable-line no-unused-vars`

法2：TS配置文件修改，tsconfig.json， noUnusedLocals修改为false，默认true时为需要检查，false不检查

```json
{
  "compilerOptions": {
	"noUnusedLocals": false, #TS6133-没有未使用变量
  },
  "include": [],
  "exclude": ["./node_modules/*superset-ui*/**/node_modules/@superset-ui/**/*"]
}
```

法3：旧的ES检查。在package.json或者.eslintrc.js其rules下加入"no-unused-vars": "off"即可，然后重新npm run serve即可。

```shell
# .eslintrc.js
module.exports = {
  rules: {
    'import/no-cycle': 0, // re-enable up for discussion, might require some major refactors
    'import/prefer-default-export': 0,
    'no-bitwise': 0,
    'no-unused-vars': 0,
  },
};
```



### nvm

官网：http://nvm.sh/ -> https://github.com/nvm-sh/nvm/blob/master/README.md

nvm可用来管理nodejs的多个版本。

```sh
# 安装nvm
$ npm install -g nvm

# 安装特定版本nodejs，并切换版本use
$ nvm install 6.14
$ nvm use 6.14

# 设置缺省nodejs版本
$ nvm alias default 8.1.0
```



### yarn

“Yarn是由Facebook、Google、Exponent 和 Tilde 联合推出了一个新的 JS 包管理工具 ，正如[官方文档](https://code.facebook.com/posts/1840075619545360)中写的，Yarn 是为了弥补 npm 的一些缺陷而出现的。

yarn安装

```shell
$ npm install -g yarn
$ yarn --version
```



Yarn的优势

* 速度更快
* 版本统一，冻结安装，依赖于package.json.lock，永远不修改package.json
* 更简洁输出
* 多安装源
* 更好的语义化命令

表格 Yarn和npm命令对比

|                          npm | yarn                 |
| ---------------------------: | :------------------- |
|                  npm install | yarn                 |
|     npm install react --save | yarn add react       |
|   npm uninstall react --save | yarn remove react    |
| npm install react --save-dev | yarn add react --dev |
|            npm update --save | yarn upgrade         |



### webpack

官网：https://webpack.js.org/

github仓库：https://github.com/webpack/webpack

**webpack** 是一个用于现代 JavaScript 应用程序的 *静态模块打包工具*。当 webpack 处理应用程序时，它会在内部构建一个 [依赖图(dependency graph)](https://webpack.docschina.org/concepts/dependency-graph/)，此依赖图对应映射到项目所需的每个模块，并生成一个或多个 *bundle*。

**webpack命令**

```shell
$ webpack --help
Usage: webpack [entries...] [options]
Alternative usage to run commands: webpack [command] [options]

The build tool for modern web applications.

Options:
  -c, --config <value...>                Provide path to a webpack configuration file e.g. ./webpack.config.js.
  --config-name <value...>               Name of the configuration to use.
  -m, --merge                            Merge two or more configurations using 'webpack-merge'.
  --env <value...>                       Environment passed to the configuration when it is a function.
  --node-env <value>                     Sets process.env.NODE_ENV to the specified value.
  --progress [value]                     Print compilation progress during build.
  -j, --json [value]                     Prints result as JSON or store it in a file.
  -d, --devtool <value>                  Determine source maps to use.
  --no-devtool                           Do not generate source maps.
  --entry <value...>                     The entry point(s) of your application e.g. ./src/main.js.
  --mode <value>                         Defines the mode to pass to webpack.
  --name <value>                         Name of the configuration. Used when loading multiple configurations.
  -o, --output-path <value>              Output location of the file generated by webpack e.g. ./dist/.
  --stats [value]                        It instructs webpack on how to treat the stats e.g. verbose.
  --no-stats                             Disable stats output.
  -t, --target <value...>                Sets the build target e.g. node.
  --no-target                            Negative 'target' option.
  -w, --watch                            Watch for files changes.
  --no-watch                             Do not watch for file changes.
  --watch-options-stdin                  Stop watching when stdin stream has ended.
  --no-watch-options-stdin               Do not stop watching when stdin stream has ended.

Global options:
  --color                                Enable colors on console.
  --no-color                             Disable colors on console.
  -v, --version                          Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  -h, --help [verbose]                   Display help for commands and options.

Commands:
  build|bundle|b [entries...] [options]  Run webpack (default command, can be omitted).
  configtest|t [config-path]             Validate a webpack configuration.
  help|h [command] [option]              Display help for commands and options.
  info|i [options]                       Outputs information about your system.
  serve|server|s [entries...] [options]  Run the webpack dev server.
  version|v [commands...]                Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  watch|w [entries...] [options]         Run webpack and watch for files changes.

To see list of all supported commands and options run 'webpack --help=verbose'.

Webpack documentation: https://webpack.js.org/.
CLI documentation: https://webpack.js.org/api/cli/.
Made with ? by the webpack team.
```



#### webpack用户篇

**核心概念**：

- [入口(entry)](https://webpack.docschina.org/concepts/#entry)： 指示 webpack 应该使用哪个模块，来作为构建其内部 依赖图(dependency graph) 的开始。
- [输出(output)](https://webpack.docschina.org/concepts/#output)  告诉 webpack 在哪里输出它所创建的 *bundle*，以及如何命名这些文件。主要输出文件的默认值是 `./dist/main.js`，其他生成文件默认放置在 `./dist` 文件夹中。
- [loader](https://webpack.docschina.org/concepts/#loaders):  定义规则处理js/json之外的文件要用到的loader
- [插件(plugin)](https://webpack.docschina.org/concepts/#plugins)：插件目的在于解决 [loader](https://www.webpackjs.com/concepts/loaders) 无法实现的**其他事**。webpack **插件**是一个具有 [`apply`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply) 属性的 JavaScript 对象。`apply` 属性会被 webpack compiler 调用，并且 compiler 对象可在**整个**编译生命周期访问。
- [模式(mode)](https://webpack.docschina.org/concepts/#mode)： 环境参数，选择 `development`, `production` 或 `none` 之中的一个，默认production
- [浏览器兼容性(browser compatibility)](https://webpack.docschina.org/concepts/#browser-compatibility)
- [环境(environment)](https://webpack.docschina.org/concepts/#environment)  webpack 5 运行于 Node.js v10.13.0+ 的版本。
- 模块：离散功能块(discrete chunks of functionality)。每个模块具有比完整程序更小的接触面，使得校验、调试、测试轻而易举。



**webpack.config.js 示例**

```js
const path = require('path');

module.exports = {
  entry: './path/to/my/entry/file.js',   //入口，可以指向字符串（SAP）或一个字典（多页面）
  output: {	//输出
    path: path.resolve(__dirname, 'dist'),
    filename: 'my-first-webpack.bundle.js',
  },

  module: {
    //loader: txt文件用raw-loader, jsx文件用babel解析
    rules: [{ test: /\.txt$/, use: 'raw-loader' }，
			{ test: /\.jsx$/, exclude:/node_modules/, loaders:['babel'] },
           ],
  },
  plugins: [new HtmlWebpackPlugin({ template: './src/index.html' })],  //插件
  mode: 'production',
};
```



**安装webpack loader**

Webpack有一个不可不说的优点，它把所有的文件都可以当做模块处理，包括你的JavaScript代码，也包括CSS和fonts以及图片等等等，只有通过合适的loaders，它们都可以被当做模块被处理。
Webpack 默认只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。

安装eslint-loader整合eslint：

```shell
npm install eslint-loader --save-dev
```

安装babel-loader整合babel：

```shell
npm install babel-loader --save-dev
```

安装style-loader css-loader等，转换对应类型文件：

```shell
npm install style-loader css-loader less-loader sass-loader file-loader url-loader --save-dev
```

css-loader 用于打包css文件
style-loader 用于将编译完成的css插入html中
less-loader 是将less文件编译成css
sass-loader 是将sass文件编译成css
file-loader 用于打包文件
url-loadder 用于打包图片

webpack提供两个工具处理样式表，css-loader 和 style-loader，二者处理的任务不同，css-loader使你能够使用类似@import 和 url(...)的方法实现 require()的功能,style-loader将所有的计算后的样式加入页面中，二者组合在一起使你能够把样式表嵌入webpack打包后的JS文件中。
url-loader是对file-loader的上层封装。一般限制小图片直接转成 base64 可以用 url-loader，其他情况都用 file-loader。



**安装webpack plugin**

与loader专注于处理资源内容不同，plugin功能更广更强大。plugin可以实现那些loader实现不了或者不适合在loader实现的功能，比如自动生成项目的HTML页面、向构建过程中注入环境变量等。

常用插件：html-webpack-plugin  uglifyjs-webpack-plugin（用于JS代码压缩）



**hash、chunkhash和contenthash**

* hash:  跟整个项目的构建相关，同一次构建过程中生成的hash都是一样的。只要项目里有文件更改，整个项目构建的hash值都会更改；没有文件更改，重新构建，生成HASH值也不一样。主要用于开发模式，客户端缓存都会失效。
* **chunkhash**：即模块hash。根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的hash值。只要文件内容没有更改就不会重复构建。如果公共库是单独模块，不修改公共库文件；非公共库文件修改后，重新构建非公共库模块，原公共库模块缓存仍能使用。
* contenthash： 表示由文件内容产生的hash值，内容不同产生的contenthash值也不一样。在项目中，通常做法是把项目中css都抽离出对应的css文件来加以引用。



#### webpack版本差异

[版本迁移指南](https://webpack.js.org/migrate/) https://webpack.docschina.org/migrate/

**前提条件**

在开始之前，请确保安装了 [Node.js](https://nodejs.org/en/) 的最新版本。使用 Node.js 最新的长期支持版本(LTS - Long Term Support)，是理想的起步。使用旧版本，你可能遇到各种问题，因为它们可能缺少 webpack 功能以及/或者缺少相关 package 包。

| 版本    | 发布时间   | npm版本要求 | 说明                                                         |
| ------- | ---------- | ----------- | ------------------------------------------------------------ |
| 1.0     | 2012-03    |             | 略                                                           |
| 2.0     |            |             | webpack 2.0之后，不能省略后缀-loader。 <br>1.新增对`ES6`语法的支持.<br>2.支持`tree-shaking` ( 减少打包后的体积 )<br>3.更新`resolve`的写法: resolve.modulesDirectories => resolve.modules<BR>4.修改module配置：外层loaders改为rules; 内层loader改为use; 所有插件必须加上 -loader，不再允许缩写; 不再支持使用!连接插件，改为数组形式; json-loader模块移除，webpack会自动处理.<br>5.移除部分plugins: 移除了OccurenceOrderPlugin、NoErrorsPlugin插件，改为内置插件 |
| 3.0     | 2017-06-20 |             | 1.Scope Hoisting : 作用域，将 function closures的包裹方式变成了可配置的形式。<br>2.Magic Comments 魔法注释（内联注释）。<br>3.新增内置插件webpack-dev-server |
| 4.0     | 2018-02-26 | 6.11.5+     | webpack 4+ 版本，还需要安装 CLI(webpack-cli)，可以不用引入一个配置文件。<br>1.mode配置选项。<br/>2.Loader使用规则：废弃loaders写法，只支持rules。<br/>3.babek使用新的命名规则@babel。<br/>4.CommonsChunkPlugin：公共库拆分插件。<br/>5.新增ini-css-extract-plugin: css代码抽离插件。把css从js文件中抽离，防止js太大，加载时间太长。<br/>6.UglifyJsPlugin：js代码压缩插件。production mode下面自动为true，optimization.minimizer可以进行个性化配置。<br/>7.happypack：多进程loader打包.当开启时，子进程执行，结果发给父进程。 |
| 5.0     | 2020-10-10 | 10.13.0+    | 1.针对 `production` 模式进行了优化<BR>2. ...                 |
| Roadmap |            |             |                                                              |

更改比较多的配置示例

```shell
# webpack 1.X：

# webpack 2.X：

# webpack 3.X：

# webpack 4.X：
const { mode } = require("webpack-nano/argv");
const {
  MiniHtmlWebpackPlugin,
} = require("mini-html-webpack-plugin");
const { WebpackPluginServe } = require("webpack-plugin-serve");

module.exports = {
  watch: mode === "development",
  entry: ["./src", "webpack-plugin-serve/client"],
  mode,
  plugins: [
    new MiniHtmlWebpackPlugin({ context: { title: "Demo" } }),
    new WebpackPluginServe({
      port: process.env.PORT || 8080,
      static: "./dist",
      liveReload: true,
      waitForBuild: true,
    }),
  ],
};
```

webpack@4以后的版本，弃用了许多@3的插件，其中包括：
分离打包js文件的插件 webpack.optimize.CommonChunkPlugin()；
压缩js文件的插件 webpack.optimize.UglifyJsPlugin();
定义产品上线环境 webpack.optimize.DedupePlugun()；
分离css文件插件 extract-text-webpack-plugin();
css文件压缩插件 CssMinimizerPlugin()；







### babel

JavaScript编译，将浏览器未实现的ECMAScript规范语法转化成可运行的低版本语法 。

我们使用 `@babel/cli` 从终端运行 Babel，利用 `@babel/polyfill` 来模拟所有新的 JavaScript 功能，而 `env` preset 只对我们所使用的并且目标浏览器中缺失的功能进行代码转换和加载 polyfill。

1. 安装

```sh
npm install --save-dev @babel/core @babel/cli @babel/preset-env
npm install --save @babel/polyfill
```

2. 配置：配置文件有多种，包括.babelrc, .babelrc.js,  babel.config.js

   .babelrc：适用于单个软件包的配置

  ```js
{
  "presets": [...],
  "plugins": [...]
}
  ```

​	  .babelrc.js： 与 [`.babelrc`](https://www.babeljs.cn/docs/configuration#babelrc) 的配置相同，但你可以使用 JavaScript 编写。

```js
const presets = [ ... ];
const plugins = [ ... ];
module.exports = { presets, plugins };
```

​	`babel.config.js`：项目根目录下，可编译node_modules目录下的模块。内容如下，
  ```js
const presets = [
  [
    "@babel/env",
    {
   targets: {
     edge: "17",
     firefox: "60",
     chrome: "67",
     safari: "11.1",
   },
   useBuiltIns: "usage",
    },
  ],
];

module.exports = { presets };
  ```

3. 运行此命令将 `src` 目录下的所有代码编译到 `lib` 目录：

   `./node_modules/.bin/babel src --out-dir lib`



### gulp

https://www.gulpjs.com.cn/

gulp.js - 基于流(stream)的自动化构建工具。Grunt 采用配置文件的方式执行任务，而Gulp一切都通过代码实现。



### grunt

Grunt和 Grunt 插件是通过[npm](https://www.npmjs.org/) 安装并管理的，npm是 [Node.js](https://nodejs.org/) 的包管理器。

Grunt 0.4.x 必须配合 Node.js `>= 0.8.0` 版本使用。

**安装**

`npm install -g grunt-cli`



**新项目**

一般需要在你的项目中添加两份文件：package.json 和 Gruntfile。

* package.json: 此文件被npm用于存储项目的元数据，以便将此项目发布为npm模块。你可以在此文件中列出项目依赖的grunt和Grunt插件，放置于devDependencies配置段内。
* Gruntfile: 此文件被命名为 Gruntfile.js 或 Gruntfile.coffee，用来配置或定义任务（task）并加载Grunt插件的。 此文档中提到的 Gruntfile 其实说的是一个文件，文件名是 Gruntfile.js 或 Gruntfile.coffee。

Gruntfile由以下几部分构成：

- "wrapper" 函数
- 项目与任务配置
- 加载grunt插件和任务
- 自定义任务

项目执行

```sh
npm install  #根据package.json安装依赖模块
grunt  #构建
```

项目脚手架： `grunt-init`



### lerna

官网：https://github.com/lerna/lerna/

Lerna 是一种工具，针对 使用 git 和 npm 管理多软件包代码仓库的工作流程进行优化。



**安装**

```shell
# 安装到全局
$ npm install --global lerna

# 创建git仓库
$ git init lerna-repo && cd lerna-repo

# 将git仓库转化成lerna仓库，会生成如下仓库结构，包括lerna.json, package.json
$ lerna init
```

lerna 代码仓库结构

```shell
lerna-repo/
  packages/
  package.json
  lerna.json
```

lerna.json示例

```json
{
  "version": "1.1.3",
  "npmClient": "npm",
  "command": {
    "publish": {
      "ignoreChanges": ["ignored-file", "*.md"],
      "message": "chore(release): publish",
      "registry": "https://npm.pkg.github.com"
    },
    "bootstrap": {
      "ignore": "component-*",
      "npmClientArgs": ["--no-package-lock"]
    }
  },
  "packages": ["packages/*"]
}
```



**常用命令**

```shell
$ lerna --help
Usage: cli.js <command> [options]

命令：
  cli.js add <pkg> [globs..]  Add a single dependency to matched packages
  cli.js bootstrap            Link local packages together and install remaining package dependencies
  cli.js changed              List local packages that have changed since the last tagged release  [aliases: updated]
  cli.js clean                Remove the node_modules directory from all packages
  cli.js create <name> [loc]  Create a new lerna-managed package
  cli.js diff [pkgName]       Diff all packages or a single package since the last release
  cli.js exec [cmd] [args..]  Execute an arbitrary command in each package
  cli.js import <dir>         Import a package into the monorepo with commit history
  cli.js info                 Prints debugging information about the local environment
  cli.js init                 Create a new Lerna repo or upgrade an existing repo to the current version of Lerna.
  cli.js link                 Symlink together all packages that are dependencies of each other
  cli.js list                 List local packages  [aliases: ls, la, ll]
  cli.js publish [bump]       Publish packages in the current project.
  cli.js run <script>         Run an npm script in each package that contains that script
  cli.js version [bump]       Bump version of packages changed since the last release.

Global Options:
      --loglevel       What level of logs to report.  [字符串] [默认值: info]
      --concurrency    How many processes to use when lerna parallelizes tasks.  [数字] [默认值: 12]
      --reject-cycles  Fail if a cycle is detected among dependencies.  [布尔]
      --no-progress    Disable progress bars. (Always off in CI)  [布尔]
      --no-sort        Do not sort packages topologically (dependencies before dependents).  [布尔]
      --max-buffer     Set max-buffer (in bytes) for subcommand execution  [数字]
  -h, --help           显示帮助信息  [布尔]
  -v, --version        显示版本号  [布尔]

When a command fails, all logs are written to lerna-debug.log in the current working directory.

For more information, find our manual at https://github.com/lerna/lerna
```



**发布 lerna publish**



lerna有两种工作模式，如下

* Independent mode   独立开发。lerna会配合`Git`，检查文件变动，只发布有改动的packge。
* Fixed/Locked mode  默认模式。把工程当作一个整体来对待。每次发布packges，都是全量发布，无论是否修改。



**lerna最佳实践**

为了能够使lerna发挥最大的作用，根据这段时间使用`lerna` 的经验，总结出一个最佳实践。下面是一些特性。

1. 采用Independent模式
2. 根据`Git`提交信息，自动生成changelog
3. eslint规则检查
4. prettier自动格式化代码
5. 提交代码，代码检查hook
6. 遵循semver版本规范



### 本章参考

* lerna: 最佳实践 https://blog.csdn.net/qq_28387069/article/details/88388909



## 3 webpack生态

* loader: 加载器，定义规则处理js/json之外的文件要用到的loader。打包构建过程中用来处理源文件的（JSX，Scss，Less..），一次处理一个。

* plugin: 插件，主要处理loader无法解决的事情，如压缩、优化、调试等等。插件可分为内置插件和第三方插件。

  * 内置插件和webpack一起安装。内置插件作为webpack的静态属性存在的。

    ```js
    const webpack = require('webpack');

    // 定义： new webpack.PLUGIN(options)
    // 示例：DefinePlugin  expose mode variable to other modules
    new webpack.DefinePlugin({
        'process.env.WEBPACK_MODE': JSON.stringify(mode),
    }),
    ```

  * 第三方插件需要额外安装。使用高频的第三方插件有可能在webpack后续版本中成为内置插件，如webpack-dev-server。

* 模块：离散功能块(discrete chunks of functionality)。每个模块具有比完整程序更小的接触面，使得校验、调试、测试轻而易举。



表格 webpack常用内置插件

| 插件英文名                       | 插件中文名         | 详述                                                         |
| -------------------------------- | ------------------ | ------------------------------------------------------------ |
| BannerPlugin                     | 横幅               | 为每个chunk生成的文件头部添加一行注释，一般用于添加作者、公司、版权等信息 |
| DefinePlugin                     | 定义               | 全局常量定义插件，使用该插件通常定义一些常量值               |
| DllPlugin <br>DllReferencePlugin | 分离公共库和业务库 | DllPlugin插件用来把需要独立打包的第三方库分离出来单独打包最后会输出两个文件，一个是打包好的第三方库bundle；还有一个是用来给 DllReferencePlugin映射依赖的manifest.json。 |
| EnvironmentPlugin                | 环境               |                                                              |
| ProgressPlugin                   | 进度               |                                                              |
| ProvidePlugin                    | 提供               | 全局自动加载模块，而不必到处 import 或 require               |
| uglifyjs-webpack-plugin          | js压缩             | 单线程压缩文件。通过UglifyJS2来完成代码压缩。                |
| **webpack-dev-server**           | http服务器         | webpack-3.0+内置此插件。会加载代理配置文件webpack.proxy-config.js |



表格 webpack常用第三方插件/模块

| 插件/模块名称                                                | 简述             | 详述                                                         |
| ------------------------------------------------------------ | ---------------- | ------------------------------------------------------------ |
| autoprefixer                                                 | 自动补全css3前缀 | 自动检测兼容性给各个浏览器加个内核前缀的插件。               |
| **clean-webpack-plugin**                                     | 清理文件         | 每次打包的时候，就会自动清除webpaco.config.js中output下的文件夹。 |
| CommonsChunkPlugin                                           | 提取公共模块     |                                                              |
| copy-webpack-plugin                                          | 复制             |                                                              |
| **extract-text-webpack-plugin**                              | 分离CSS          | Extract text from bundle into a file. 把额外的数据加到编译好的文件中。<br>Webpack打包默认会把css和js打包在一块，然而我们通常习惯将css代码中放在标签中，而将js引用放在页面底部。<br>将css代码放在页面头部可以避免 FOUC 问题。同时如果css和js分离也有利于这加强样式的可缓存性。<br>用此插件来分离js与css使得样式文件单独打包。 |
| **fork-ts-checker-webpack-plugin**                           | 多进程ts检查     |                                                              |
| **html-webpack-plugin**                                      | HTML打包         | 简化了HTML文件的创建                                         |
| mini-css-extract-plugin                                      | 迷你css抽取      |                                                              |
| optimize-css-assets-webpack-plugin                           | css优化          |                                                              |
| speed-measure-webpack-plugin                                 | 加速计量         | --measure=true                                               |
| [terser-webpack-plugin](https://webpack.docschina.org/plugins/terser-webpack-plugin/) | 压缩代码         | webpack-4.0默认                                              |
| webpack-bundle-analyzer                                      | 打包分析         |                                                              |
| webpack-manifest-plugin                                      |                  |                                                              |
| webpack-parallel-uglify-plugin                               | 并行压缩         | 多进程并行运行UglifyJS插件。                                 |
| ...                                                          |                  |                                                              |

备注：1. **FOUC** - flash of unstyled content，指的是网页渲染时，外部样式还没加载好，就以浏览器默认样式短暂地展示了部分内容，等到外部样式加载完成，又恢复正常的这个页面闪烁的过程。



### webpack-dev-server

webpack-dev-server是一个使用了express的Http服务器，它的作用主要是为了监听资源文件的改变，该http服务器和client使用了websocket通信协议，只要资源文件发生改变，webpack-dev-server就会实时的进行编译。

```shell
$ npm show webpack-dev-server

webpack-dev-server@4.6.0 | MIT | deps: 25 | versions: 188
Serves a webpack app. Updates the browser on changes.
https://github.com/webpack/webpack-dev-server#readme

bin: webpack-dev-server

dist
.tarball: https://registry.npmjs.org/webpack-dev-server/-/webpack-dev-server-4.6.0.tgz
.shasum: e8648601c440172d9b6f248d28db98bed335315a
.integrity: sha512-oojcBIKvx3Ya7qs1/AVWHDgmP1Xml8rGsEBnSobxU/UJSX1xP1GPM3MwsAnDzvqcVmVki8tV7lbcsjEjk0PtYg==
.unpackedSize: 461.4 kB

dependencies:
ansi-html-community: ^0.0.8          default-gateway: ^6.0.3              ipaddr.js: ^2.0.1                    serve-index: ^1.9.1
bonjour: ^3.5.0                      del: ^6.0.0                          open: ^8.0.9                         sockjs: ^0.3.21
chokidar: ^3.5.2                     express: ^4.17.1                     p-retry: ^4.5.0                      spdy: ^4.0.2
colorette: ^2.0.10                   graceful-fs: ^4.2.6                  portfinder: ^1.0.28                  strip-ansi: ^7.0.0
compression: ^1.7.4                  html-entities: ^2.3.2                schema-utils: ^4.0.0                 url: ^0.11.0
connect-history-api-fallback: ^1.6.0 http-proxy-middleware: ^2.0.0        selfsigned: ^1.10.11                 webpack-dev-middleware: ^5.2.1
(...and 1 more.)

maintainers:
- sokra <tobias.koppers@googlemail.com>
- jhnns <mail@johannesewald.de>
- evilebottnawi <sheo13666q@gmail.com>
- hiroppy <hello@hiroppy.me>

dist-tags:
beta: 3.0.1-beta.0  latest: 4.6.0       next: 4.0.0-rc.1    version-3: 3.11.3   webpack-1: 1.16.5   webpack-3: 2.11.5

published 6 days ago by evilebottnawi <sheo13666q@gmail.com>
```



webpack-dev-server为了加快打包进程是将打包后的文件放到内存中的，所以在项目中是看不到它打包以后生成的文件／文件夹的，但仍然需要配置路径：

* output.path这个参数是配置 打包文件的保存路径的，
* contentBase在webpack-dev-server中的作用就和output.path是同等的，如果不配置这个参数，webpack-dev-server就会将文件（隐藏文件）打包到项目的根路径下。



**主要特性**

* **热更新**：webpack-dev-sever支持两种自动刷新方式 —— Iframe mode、Inline mode

* **热替换(HMR)**  HMR（Hot Module Replacement）能够实现在页面不刷新的情况下，代码也可以及时的更新到浏览器的页面中，重新执行，避免页面状态丢失。当我们使用webpack-dev-server的自动刷新功能时，浏览器会整页刷新。而热替换的区别就在于，当前端代码变动时，无需刷新整个页面，只把变化的部分替换掉。
* **Proxy代理**：  最终代理服务器地址在 webpack-proxy.config.js里配置。



 webpack.config.js  （只列出webpack-dev-server 相关代码）

```js
const getProxyConfig = require('./webpack.proxy-config');	//获取此文件的module.exports数据

const APP_DIR = path.resolve(__dirname, './');
const isDevServer = process.argv[1].includes('webpack-dev-server');
const PREAMBLE = [path.join(APP_DIR, '/src/preamble.ts')];
if (isDevMode) {	// 开发模式，即 isDevServer为True
  PREAMBLE.unshift(
    `webpack-dev-server/client?http://localhost:${devserverPort}`,
  );

  config.devtool = 'eval-cheap-module-source-map';
  config.devServer = {
    before(app, server, compiler) {
      // load proxy config when manifest updates
      const hook = compiler.hooks.webpackManifestPluginAfterEmit;
      hook.tap('ManifestPlugin', manifest => {
        proxyConfig = getProxyConfig(manifest);  //读入代理配置文件 webpack.proxy-config.js
      });
    },
}
```



webpack.proxy-config.js

```js
// 下面指定 需要代理的远程服务器地址和端口 supersetUrl
const { supersetPort = 8088, superset: supersetUrl = null } = parsedArgs;
const backend = (supersetUrl || `http://localhost:${supersetPort}`).replace('//+$/','',);   //移除尾部符号/

...
// 模块导出数据
module.exports = newManifest => {
  manifest = newManifest;
  return {
    context: '/',
    target: backend,
    hostRewrite: true,
    changeOrigin: true,
    cookieDomainRewrite: '', // remove cookie domain
    selfHandleResponse: true, // so that the onProxyRes takes care of sending the response
    onProxyRes(proxyResponse, request, response) {
      try {
        copyHeaders(proxyResponse, response);
        if (isHTML(response)) {
          processHTML(proxyResponse, response);
        } else {
          proxyResponse.pipe(response);
        }
        response.flushHeaders();
      } catch (e) {
        response.setHeader('content-type', 'text/plain');
        response.write(`Error requesting ${request.path} from proxy:\n\n`);
        response.end(e.stack);
      }
    },
  };
};
```



### html-webpack-plugin

```js
const HtmlWebpackPlugin = require('html-webpack-plugin')
 plugins: [
  new HtmlWebpackPlugin({ // 打包输出HTML
   title: 'Hello World',//文件的标题
   minify: { //minify 的作用是对 html 文件进行压缩
    removeComments: true, // 移除HTML中的注释
    collapseWhitespace: true, // 删除空白符与换行符
    minifyCSS: true, // //是否压缩html里的css 默认值false；
    caseSensitive: true, //是否对大小写敏感，默认false
    ollapseWhitespace: true, //是否去除空格，默认false
    minifyJS: true, //是否压缩html里的js
    removeAttributeQuotes: true, //是否移除属性的引号 默认false
    removeComments: true, //是否移除注释 默认false
    emoveCommentsFromCDATA: true, //从脚本和样式删除的注释 默认false
    emoveEmptyAttributes: true, //是否删除空属性，默认false
    removeRedundantAttributes: true, //删除多余的属性
    removeScriptTypeAttributes: true, //删除script的类型属性，在h5下面script的type默认值：text/javascript 默认值false
   },
   filename: 'index.html', //输出的html的文件名称
   template: 'index.html', //html模板在的文件路径
   hash: true,//hash作用是给生成的js文件一个独特的hash值，默认值为false 被构建过后的html引用js效果如下
   // <script type=text/javascript src=bundle.js?22b9692e22e7be37b57e></script>
  }),
 ]
```



### extract-text-webpack-plugin





### 本章参考

* [白屏问题和FOUC - 简书](https://www.jianshu.com/p/6617efa874b0)
* Webpack常用插件总结 https://blog.csdn.net/qq_39040042/article/details/88019723
* 常用的18个webpack插件总结 https://blog.csdn.net/weixin_43720095/article/details/107720200
* webpack打包分析与性能优化 https://zhuanlan.zhihu.com/p/25212283
* webpack之前端性能优化 https://www.cnblogs.com/ssh-007/p/7944491.html
* Webpack-dev-server的proxy用法 https://segmentfault.com/a/1190000016314976



#  参考资料

## 官网资料

**官网**

* npm https://www.npmjs.com/
* nvm http://nvm.sh/  ->  https://github.com/nvm-sh/nvm/blob/master/README.md
* webpack https://webpack.js.org/
* yarn  https://www.yarnpkg.com   https://github.com/yarnpkg/yarn
* babel  https://babeljs.io
* grunt  http://www.gruntjs.net/
* gulp  https://gulpjs.com/
* lerna  https://github.com/lerna/lerna/



**中文文档**

* webpack中文文档  https://webpack.docschina.org
* yarn中文文档  https://www.yarnpkg.cn
* babel中文文档  https://babel.docschina.org
* gulp.js  https://www.gulpjs.com.cn/
* lerna   https://www.lernajs.cn/



## 参考链接

* babel在线转换 "https://babeljs.io/repl/"
* 知乎ServerLess " https://zhuanlan.zhihu.com/p/65914436 "
* TS基础  https://blog.csdn.net/qq_39403733/article/details/93756705
* ts语法总结 https://blog.csdn.net/qq_15701939/article/details/83934608
* TypeScript 高级用法 https://www.cnblogs.com/cczlovexw/p/14389259.html
* Webpack 各版本 ( v1 - v4 ) 的区别 https://blog.csdn.net/Vue2018/article/details/106501629/



